{"ast":null,"code":"import _createForOfIteratorHelper from\"/home/y-yabust/CC/cc-replay/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _regeneratorRuntime from\"/home/y-yabust/CC/cc-replay/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/y-yabust/CC/cc-replay/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{delay,getFrameByTurn,streamAllEvents}from\"../utils/engine-client\";import*as types from\"./action-types\";import{DEFAULT_FRAMERATE}from\"../components/settings/defaults\";export var setGameOptions=function setGameOptions(gameOptions){return{type:types.SET_GAME_OPTIONS,gameOptions:gameOptions};};export var setTheme=function setTheme(theme){return{type:types.SET_THEME,theme:theme};};export var gameOver=function gameOver(){return{type:types.GAME_OVER};};export var gameNotFound=function gameNotFound(){return{type:types.GAME_NOT_FOUND};};export var requestFrames=function requestFrames(){return{type:types.REQUEST_FRAMES};};export var receiveFrame=function receiveFrame(game,frame){return{type:types.RECEIVE_FRAME,game:game,frame:frame};};export var receiveEventEnd=function receiveEventEnd(game,endEvent,frame){return{type:types.RECEIVE_EVENT_END,game:game,endEvent:endEvent,frame:frame};};export var setCurrentFrame=function setCurrentFrame(frame){return{type:types.SET_CURRENT_FRAME,frame:frame};};export var pauseGame=function pauseGame(){return{type:types.PAUSE_GAME};};export var resumeGame=function resumeGame(){return{type:types.RESUME_GAME};};export var highlightSnake=function highlightSnake(snakeId){return{type:types.HIGHLIGHT_SNAKE,snakeId:snakeId};};export var fetchFrames=function fetchFrames(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState){var _getState$game$gameOp,autoplay,engineUrl,gameId,turn,frame;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_getState$game$gameOp=getState().game.gameOptions,autoplay=_getState$game$gameOp.autoplay,engineUrl=_getState$game$gameOp.engine,gameId=_getState$game$gameOp.game,turn=_getState$game$gameOp.turn;dispatch(requestFrames());console.log(getState().game.gameOption);_context.prev=3;_context.next=6;return streamAllEvents(engineUrl,gameId,function(game,eventType,eventData){if(eventType===\"frame\"){var frame=eventData;// Workaround for bug where turn exluded on turn 0\n// Workaround for bug where turn exluded on turn 0\nframe.Turn=frame.Turn||0;dispatch(receiveFrame(game,frame));// Workaround to render the first frame into the board\n// Workaround to render the first frame into the board\nif(frame.Turn===0){var _frame=getState().game.frames[0];dispatch(setCurrentFrame(_frame));if(autoplay){dispatch(resumeGame());dispatch(playFromFrame(_frame));}}}else if(eventType===\"game_end\"){var numFrames=getState().game.frames.length;var _frame2=getState().game.frames[numFrames-1];_frame2.gameOver=true;dispatch(receiveEventEnd(game,eventData,_frame2));}});case 6:_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](3);console.log(_context.t0);return _context.abrupt(\"return\",dispatch(gameNotFound()));case 12:// Only navigate to the specified frame if it is within the\n// amount of frames available in the game\nif(turn&&turn<=getState().game.frames.length){frame=getState().game.frames[turn];dispatch(setCurrentFrame(frame));}case 13:case\"end\":return _context.stop();}}},_callee,null,[[3,8]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();};export var playFromFrame=function playFromFrame(frame){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,getState){var frameRate,frames,frameIndex,slicedFrames,ceiledFps,delayMillis,_iterator,_step,_frame4,lastFrame,_frame3;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:frameRate=getState().game.gameOptions.frameRate;frames=getState().game.frames.slice();// Don't modify in place\nframeIndex=frames.indexOf(frame);slicedFrames=frames.slice(frameIndex);ceiledFps=Math.ceil(frameRate||DEFAULT_FRAMERATE);delayMillis=1000/ceiledFps;_iterator=_createForOfIteratorHelper(slicedFrames);_context2.prev=7;_iterator.s();case 9:if((_step=_iterator.n()).done){_context2.next=18;break;}_frame4=_step.value;if(!getState().game.paused){_context2.next=13;break;}return _context2.abrupt(\"return\");case 13:dispatch(setCurrentFrame(_frame4));_context2.next=16;return delay(delayMillis);case 16:_context2.next=9;break;case 18:_context2.next=23;break;case 20:_context2.prev=20;_context2.t0=_context2[\"catch\"](7);_iterator.e(_context2.t0);case 23:_context2.prev=23;_iterator.f();return _context2.finish(23);case 26:lastFrame=slicedFrames[slicedFrames.length-1];if(lastFrame.gameOver){if(!getState().game.paused){if(getState().game.gameOptions.loop){_frame3=getFrameByTurn(frames,0);dispatch(playFromFrame(_frame3));}else{dispatch(gameOver());}}}else{dispatch(playFromFrame(lastFrame));}case 28:case\"end\":return _context2.stop();}}},_callee2,null,[[7,20,23,26]]);}));return function(_x3,_x4){return _ref2.apply(this,arguments);};}();};export var reloadGame=function reloadGame(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch,getState){var _getState$game,frames,paused,frame;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_getState$game=getState().game,frames=_getState$game.frames,paused=_getState$game.paused;if(paused){frame=getFrameByTurn(frames,0);dispatch(setCurrentFrame(frame));}case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x5,_x6){return _ref3.apply(this,arguments);};}();};export var toggleGamePause=function toggleGamePause(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch,getState){var _getState$game2,currentFrame,paused;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_getState$game2=getState().game,currentFrame=_getState$game2.currentFrame,paused=_getState$game2.paused;if(paused){dispatch(resumeGame());dispatch(playFromFrame(currentFrame));}else{dispatch(pauseGame());}case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7,_x8){return _ref4.apply(this,arguments);};}();};export var pauseGameAction=function pauseGameAction(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch,getState){var paused;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:paused=getState().game.paused;if(!paused){dispatch(pauseGame());}case 2:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x9,_x10){return _ref5.apply(this,arguments);};}();};export var toggleTheme=function toggleTheme(themeToSet){return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:dispatch(setTheme(themeToSet));case 1:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x11){return _ref6.apply(this,arguments);};}();};export var stepForwardFrame=function stepForwardFrame(){return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch,getState){var _getState$game3,currentFrame,frames,nextFrame,stepToFrame;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_getState$game3=getState().game,currentFrame=_getState$game3.currentFrame,frames=_getState$game3.frames;nextFrame=currentFrame.turn+1;stepToFrame=getFrameByTurn(frames,nextFrame);if(stepToFrame){dispatch(setCurrentFrame(stepToFrame));}case 4:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x12,_x13){return _ref7.apply(this,arguments);};}();};export var stepBackwardFrame=function stepBackwardFrame(){return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(dispatch,getState){var _getState$game4,currentFrame,frames,prevFrame,stepToFrame;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_getState$game4=getState().game,currentFrame=_getState$game4.currentFrame,frames=_getState$game4.frames;prevFrame=currentFrame.turn-1;stepToFrame=getFrameByTurn(frames,prevFrame);if(stepToFrame){dispatch(setCurrentFrame(stepToFrame));}case 4:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x14,_x15){return _ref8.apply(this,arguments);};}();};export var stepToTurn=function stepToTurn(turn){return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dispatch,getState){var frames,stepToFrame;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:frames=getState().game.frames;stepToFrame=getFrameByTurn(frames,turn);if(stepToFrame){dispatch(setCurrentFrame(stepToFrame));}case 3:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x16,_x17){return _ref9.apply(this,arguments);};}();};export var togglePlayButtons=function togglePlayButtons(showHide){return{type:types.TOGGLE_SETTINGS_VIEW,showHide:showHide};};export var themeChanged=function themeChanged(theme){return{type:types.THEME_CHANGED,theme:theme};};","map":{"version":3,"sources":["/home/y-yabust/CC/cc-replay/src/actions/index.js"],"names":["delay","getFrameByTurn","streamAllEvents","types","DEFAULT_FRAMERATE","setGameOptions","gameOptions","type","SET_GAME_OPTIONS","setTheme","theme","SET_THEME","gameOver","GAME_OVER","gameNotFound","GAME_NOT_FOUND","requestFrames","REQUEST_FRAMES","receiveFrame","game","frame","RECEIVE_FRAME","receiveEventEnd","endEvent","RECEIVE_EVENT_END","setCurrentFrame","SET_CURRENT_FRAME","pauseGame","PAUSE_GAME","resumeGame","RESUME_GAME","highlightSnake","snakeId","HIGHLIGHT_SNAKE","fetchFrames","dispatch","getState","autoplay","engineUrl","engine","gameId","turn","console","log","gameOption","eventType","eventData","Turn","frames","playFromFrame","numFrames","length","frameRate","slice","frameIndex","indexOf","slicedFrames","ceiledFps","Math","ceil","delayMillis","paused","lastFrame","loop","reloadGame","toggleGamePause","currentFrame","pauseGameAction","toggleTheme","themeToSet","stepForwardFrame","nextFrame","stepToFrame","stepBackwardFrame","prevFrame","stepToTurn","togglePlayButtons","showHide","TOGGLE_SETTINGS_VIEW","themeChanged","THEME_CHANGED"],"mappings":"+VAAA,OAASA,KAAT,CAAgBC,cAAhB,CAAgCC,eAAhC,KAAuD,wBAAvD,CACA,MAAO,GAAKC,CAAAA,KAAZ,KAAuB,gBAAvB,CACA,OAASC,iBAAT,KAAkC,iCAAlC,CAEA,MAAO,IAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAAAC,WAAW,QAAK,CAC5CC,IAAI,CAAEJ,KAAK,CAACK,gBADgC,CAE5CF,WAAW,CAAXA,WAF4C,CAAL,EAAlC,CAKP,MAAO,IAAMG,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAC,KAAK,QAAK,CAChCH,IAAI,CAAEJ,KAAK,CAACQ,SADoB,CAEhCD,KAAK,CAALA,KAFgC,CAAL,EAAtB,CAKP,MAAO,IAAME,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,SAAO,CAC7BL,IAAI,CAAEJ,KAAK,CAACU,SADiB,CAAP,EAAjB,CAIP,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,SAAO,CACjCP,IAAI,CAAEJ,KAAK,CAACY,cADqB,CAAP,EAArB,CAIP,MAAO,IAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,SAAO,CAClCT,IAAI,CAAEJ,KAAK,CAACc,cADsB,CAAP,EAAtB,CAIP,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,IAAD,CAAOC,KAAP,QAAkB,CAC5Cb,IAAI,CAAEJ,KAAK,CAACkB,aADgC,CAE5CF,IAAI,CAAJA,IAF4C,CAG5CC,KAAK,CAALA,KAH4C,CAAlB,EAArB,CAMP,MAAO,IAAME,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACH,IAAD,CAAOI,QAAP,CAAiBH,KAAjB,QAA4B,CACzDb,IAAI,CAAEJ,KAAK,CAACqB,iBAD6C,CAEzDL,IAAI,CAAJA,IAFyD,CAGzDI,QAAQ,CAARA,QAHyD,CAIzDH,KAAK,CAALA,KAJyD,CAA5B,EAAxB,CAOP,MAAO,IAAMK,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAAL,KAAK,QAAK,CACvCb,IAAI,CAAEJ,KAAK,CAACuB,iBAD2B,CAEvCN,KAAK,CAALA,KAFuC,CAAL,EAA7B,CAKP,MAAO,IAAMO,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,SAAO,CAC9BpB,IAAI,CAAEJ,KAAK,CAACyB,UADkB,CAAP,EAAlB,CAIP,MAAO,IAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,SAAO,CAC/BtB,IAAI,CAAEJ,KAAK,CAAC2B,WADmB,CAAP,EAAnB,CAIP,MAAO,IAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAAAC,OAAO,QAAK,CACxCzB,IAAI,CAAEJ,KAAK,CAAC8B,eAD4B,CAExCD,OAAO,CAAPA,OAFwC,CAAL,EAA9B,CAKP,MAAO,IAAME,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CAC/B,+FAAO,iBAAOC,QAAP,CAAiBC,QAAjB,uMAMDA,QAAQ,GAAGjB,IAAX,CAAgBb,WANf,CAEH+B,QAFG,uBAEHA,QAFG,CAGKC,SAHL,uBAGHC,MAHG,CAIGC,MAJH,uBAIHrB,IAJG,CAKHsB,IALG,uBAKHA,IALG,CAOLN,QAAQ,CAACnB,aAAa,EAAd,CAAR,CACA0B,OAAO,CAACC,GAAR,CAAYP,QAAQ,GAAGjB,IAAX,CAAgByB,UAA5B,EARK,sCAUG1C,CAAAA,eAAe,CAACoC,SAAD,CAAYE,MAAZ,CAAoB,SAACrB,IAAD,CAAO0B,SAAP,CAAkBC,SAAlB,CAAgC,CACvE,GAAID,SAAS,GAAK,OAAlB,CAA2B,CACzB,GAAMzB,CAAAA,KAAK,CAAG0B,SAAd,CACA;AAAA;AACA1B,KAAK,CAAC2B,IAAN,CAAa3B,KAAK,CAAC2B,IAAN,EAAc,CAA3B,CACAZ,QAAQ,CAACjB,YAAY,CAACC,IAAD,CAAOC,KAAP,CAAb,CAAR,CAEA;AAAA;AACA,GAAIA,KAAK,CAAC2B,IAAN,GAAe,CAAnB,CAAsB,CACpB,GAAM3B,CAAAA,MAAK,CAAGgB,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuB,CAAvB,CAAd,CACAb,QAAQ,CAACV,eAAe,CAACL,MAAD,CAAhB,CAAR,CAEA,GAAIiB,QAAJ,CAAc,CACZF,QAAQ,CAACN,UAAU,EAAX,CAAR,CACAM,QAAQ,CAACc,aAAa,CAAC7B,MAAD,CAAd,CAAR,CACD,CACF,CACF,CAhBD,IAgBO,IAAIyB,SAAS,GAAK,UAAlB,CAA8B,CACnC,GAAMK,CAAAA,SAAS,CAAGd,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuBG,MAAzC,CACA,GAAM/B,CAAAA,OAAK,CAAGgB,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuBE,SAAS,CAAG,CAAnC,CAAd,CACA9B,OAAK,CAACR,QAAN,CAAiB,IAAjB,CACAuB,QAAQ,CAACb,eAAe,CAACH,IAAD,CAAO2B,SAAP,CAAkB1B,OAAlB,CAAhB,CAAR,CACD,CACF,CAvBoB,CAVlB,uFAmCHsB,OAAO,CAACC,GAAR,cAnCG,gCAoCIR,QAAQ,CAACrB,YAAY,EAAb,CApCZ,UAuCL;AACA;AACA,GAAI2B,IAAI,EAAIA,IAAI,EAAIL,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuBG,MAA3C,CAAmD,CAC3C/B,KAD2C,CACnCgB,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuBP,IAAvB,CADmC,CAEjDN,QAAQ,CAACV,eAAe,CAACL,KAAD,CAAhB,CAAR,CACD,CA5CI,oEAAP,mEA8CD,CA/CM,CAiDP,MAAO,IAAM6B,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAA7B,KAAK,CAAI,CACpC,gGAAO,kBAAOe,QAAP,CAAiBC,QAAjB,mOACGgB,SADH,CACiBhB,QAAQ,GAAGjB,IAAX,CAAgBb,WADjC,CACG8C,SADH,CAECJ,MAFD,CAEUZ,QAAQ,GAAGjB,IAAX,CAAgB6B,MAAhB,CAAuBK,KAAvB,EAFV,CAE0C;AACzCC,UAHD,CAGcN,MAAM,CAACO,OAAP,CAAenC,KAAf,CAHd,CAICoC,YAJD,CAIgBR,MAAM,CAACK,KAAP,CAAaC,UAAb,CAJhB,CAMCG,SAND,CAMaC,IAAI,CAACC,IAAL,CAAUP,SAAS,EAAIhD,iBAAvB,CANb,CAOCwD,WAPD,CAOe,KAAOH,SAPtB,sCASeD,YATf,gGASMpC,OATN,iBAUCgB,QAAQ,GAAGjB,IAAX,CAAgB0C,MAVjB,qEAWH1B,QAAQ,CAACV,eAAe,CAACL,OAAD,CAAhB,CAAR,CAXG,wBAYGpB,CAAAA,KAAK,CAAC4D,WAAD,CAZR,mOAeCE,SAfD,CAeaN,YAAY,CAACA,YAAY,CAACL,MAAb,CAAsB,CAAvB,CAfzB,CAgBL,GAAIW,SAAS,CAAClD,QAAd,CAAwB,CACtB,GAAI,CAACwB,QAAQ,GAAGjB,IAAX,CAAgB0C,MAArB,CAA6B,CAC3B,GAAIzB,QAAQ,GAAGjB,IAAX,CAAgBb,WAAhB,CAA4ByD,IAAhC,CAAsC,CAC9B3C,OAD8B,CACtBnB,cAAc,CAAC+C,MAAD,CAAS,CAAT,CADQ,CAEpCb,QAAQ,CAACc,aAAa,CAAC7B,OAAD,CAAd,CAAR,CACD,CAHD,IAGO,CACLe,QAAQ,CAACvB,QAAQ,EAAT,CAAR,CACD,CACF,CACF,CATD,IASO,CACLuB,QAAQ,CAACc,aAAa,CAACa,SAAD,CAAd,CAAR,CACD,CA3BI,6EAAP,qEA6BD,CA9BM,CAgCP,MAAO,IAAME,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CAC9B,gGAAO,kBAAO7B,QAAP,CAAiBC,QAAjB,4KACsBA,QAAQ,GAAGjB,IADjC,CACG6B,MADH,gBACGA,MADH,CACWa,MADX,gBACWA,MADX,CAEL,GAAIA,MAAJ,CAAY,CACJzC,KADI,CACInB,cAAc,CAAC+C,MAAD,CAAS,CAAT,CADlB,CAEVb,QAAQ,CAACV,eAAe,CAACL,KAAD,CAAhB,CAAR,CACD,CALI,wDAAP,qEAOD,CARM,CAUP,MAAO,IAAM6C,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CACnC,gGAAO,kBAAO9B,QAAP,CAAiBC,QAAjB,8KAC4BA,QAAQ,GAAGjB,IADvC,CACG+C,YADH,iBACGA,YADH,CACiBL,MADjB,iBACiBA,MADjB,CAGL,GAAIA,MAAJ,CAAY,CACV1B,QAAQ,CAACN,UAAU,EAAX,CAAR,CACAM,QAAQ,CAACc,aAAa,CAACiB,YAAD,CAAd,CAAR,CACD,CAHD,IAGO,CACL/B,QAAQ,CAACR,SAAS,EAAV,CAAR,CACD,CARI,wDAAP,qEAUD,CAXM,CAaP,MAAO,IAAMwC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CACnC,gGAAO,kBAAOhC,QAAP,CAAiBC,QAAjB,iIACGyB,MADH,CACczB,QAAQ,GAAGjB,IADzB,CACG0C,MADH,CAGL,GAAI,CAACA,MAAL,CAAa,CACX1B,QAAQ,CAACR,SAAS,EAAV,CAAR,CACD,CALI,wDAAP,sEAOD,CARM,CAUP,MAAO,IAAMyC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAAAC,UAAU,CAAI,CACvC,gGAAO,kBAAMlC,QAAN,sHACLA,QAAQ,CAAC1B,QAAQ,CAAC4D,UAAD,CAAT,CAAR,CADK,wDAAP,kEAGD,CAJM,CAMP,MAAO,IAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CACpC,gGAAO,kBAAOnC,QAAP,CAAiBC,QAAjB,oMAC4BA,QAAQ,GAAGjB,IADvC,CACG+C,YADH,iBACGA,YADH,CACiBlB,MADjB,iBACiBA,MADjB,CAECuB,SAFD,CAEaL,YAAY,CAACzB,IAAb,CAAoB,CAFjC,CAGC+B,WAHD,CAGevE,cAAc,CAAC+C,MAAD,CAASuB,SAAT,CAH7B,CAIL,GAAIC,WAAJ,CAAiB,CACfrC,QAAQ,CAACV,eAAe,CAAC+C,WAAD,CAAhB,CAAR,CACD,CANI,wDAAP,uEAQD,CATM,CAWP,MAAO,IAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,EAAM,CACrC,gGAAO,kBAAOtC,QAAP,CAAiBC,QAAjB,oMAC4BA,QAAQ,GAAGjB,IADvC,CACG+C,YADH,iBACGA,YADH,CACiBlB,MADjB,iBACiBA,MADjB,CAEC0B,SAFD,CAEaR,YAAY,CAACzB,IAAb,CAAoB,CAFjC,CAGC+B,WAHD,CAGevE,cAAc,CAAC+C,MAAD,CAAS0B,SAAT,CAH7B,CAIL,GAAIF,WAAJ,CAAiB,CACfrC,QAAQ,CAACV,eAAe,CAAC+C,WAAD,CAAhB,CAAR,CACD,CANI,wDAAP,uEAQD,CATM,CAWP,MAAO,IAAMG,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAAAlC,IAAI,CAAI,CAChC,gGAAO,kBAAON,QAAP,CAAiBC,QAAjB,6IACGY,MADH,CACcZ,QAAQ,GAAGjB,IADzB,CACG6B,MADH,CAGCwB,WAHD,CAGevE,cAAc,CAAC+C,MAAD,CAASP,IAAT,CAH7B,CAIL,GAAI+B,WAAJ,CAAiB,CACfrC,QAAQ,CAACV,eAAe,CAAC+C,WAAD,CAAhB,CAAR,CACD,CANI,wDAAP,uEAQD,CATM,CAWP,MAAO,IAAMI,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAAC,QAAQ,QAAK,CAC5CtE,IAAI,CAAEJ,KAAK,CAAC2E,oBADgC,CAE5CD,QAAQ,CAARA,QAF4C,CAAL,EAAlC,CAKP,MAAO,IAAME,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAArE,KAAK,QAAK,CACpCH,IAAI,CAAEJ,KAAK,CAAC6E,aADwB,CAEpCtE,KAAK,CAALA,KAFoC,CAAL,EAA1B","sourcesContent":["import { delay, getFrameByTurn, streamAllEvents } from \"../utils/engine-client\";\nimport * as types from \"./action-types\";\nimport { DEFAULT_FRAMERATE } from \"../components/settings/defaults\";\n\nexport const setGameOptions = gameOptions => ({\n  type: types.SET_GAME_OPTIONS,\n  gameOptions\n});\n\nexport const setTheme = theme => ({\n  type: types.SET_THEME,\n  theme\n});\n\nexport const gameOver = () => ({\n  type: types.GAME_OVER\n});\n\nexport const gameNotFound = () => ({\n  type: types.GAME_NOT_FOUND\n});\n\nexport const requestFrames = () => ({\n  type: types.REQUEST_FRAMES\n});\n\nexport const receiveFrame = (game, frame) => ({\n  type: types.RECEIVE_FRAME,\n  game,\n  frame\n});\n\nexport const receiveEventEnd = (game, endEvent, frame) => ({\n  type: types.RECEIVE_EVENT_END,\n  game,\n  endEvent,\n  frame\n});\n\nexport const setCurrentFrame = frame => ({\n  type: types.SET_CURRENT_FRAME,\n  frame\n});\n\nexport const pauseGame = () => ({\n  type: types.PAUSE_GAME\n});\n\nexport const resumeGame = () => ({\n  type: types.RESUME_GAME\n});\n\nexport const highlightSnake = snakeId => ({\n  type: types.HIGHLIGHT_SNAKE,\n  snakeId\n});\n\nexport const fetchFrames = () => {\n  return async (dispatch, getState) => {\n    const {\n      autoplay,\n      engine: engineUrl,\n      game: gameId,\n      turn\n    } = getState().game.gameOptions;\n    dispatch(requestFrames());\n    console.log(getState().game.gameOption);\n    try {\n      await streamAllEvents(engineUrl, gameId, (game, eventType, eventData) => {\n        if (eventType === \"frame\") {\n          const frame = eventData;\n          // Workaround for bug where turn exluded on turn 0\n          frame.Turn = frame.Turn || 0;\n          dispatch(receiveFrame(game, frame));\n\n          // Workaround to render the first frame into the board\n          if (frame.Turn === 0) {\n            const frame = getState().game.frames[0];\n            dispatch(setCurrentFrame(frame));\n\n            if (autoplay) {\n              dispatch(resumeGame());\n              dispatch(playFromFrame(frame));\n            }\n          }\n        } else if (eventType === \"game_end\") {\n          const numFrames = getState().game.frames.length;\n          const frame = getState().game.frames[numFrames - 1];\n          frame.gameOver = true;\n          dispatch(receiveEventEnd(game, eventData, frame));\n        }\n      });\n    } catch (e) {\n      console.log(e);\n      return dispatch(gameNotFound());\n    }\n\n    // Only navigate to the specified frame if it is within the\n    // amount of frames available in the game\n    if (turn && turn <= getState().game.frames.length) {\n      const frame = getState().game.frames[turn];\n      dispatch(setCurrentFrame(frame));\n    }\n  };\n};\n\nexport const playFromFrame = frame => {\n  return async (dispatch, getState) => {\n    const { frameRate } = getState().game.gameOptions;\n    const frames = getState().game.frames.slice(); // Don't modify in place\n    const frameIndex = frames.indexOf(frame);\n    const slicedFrames = frames.slice(frameIndex);\n\n    const ceiledFps = Math.ceil(frameRate || DEFAULT_FRAMERATE);\n    const delayMillis = 1000 / ceiledFps;\n\n    for (const frame of slicedFrames) {\n      if (getState().game.paused) return;\n      dispatch(setCurrentFrame(frame));\n      await delay(delayMillis);\n    }\n\n    const lastFrame = slicedFrames[slicedFrames.length - 1];\n    if (lastFrame.gameOver) {\n      if (!getState().game.paused) {\n        if (getState().game.gameOptions.loop) {\n          const frame = getFrameByTurn(frames, 0);\n          dispatch(playFromFrame(frame));\n        } else {\n          dispatch(gameOver());\n        }\n      }\n    } else {\n      dispatch(playFromFrame(lastFrame));\n    }\n  };\n};\n\nexport const reloadGame = () => {\n  return async (dispatch, getState) => {\n    const { frames, paused } = getState().game;\n    if (paused) {\n      const frame = getFrameByTurn(frames, 0);\n      dispatch(setCurrentFrame(frame));\n    }\n  };\n};\n\nexport const toggleGamePause = () => {\n  return async (dispatch, getState) => {\n    const { currentFrame, paused } = getState().game;\n\n    if (paused) {\n      dispatch(resumeGame());\n      dispatch(playFromFrame(currentFrame));\n    } else {\n      dispatch(pauseGame());\n    }\n  };\n};\n\nexport const pauseGameAction = () => {\n  return async (dispatch, getState) => {\n    const { paused } = getState().game;\n\n    if (!paused) {\n      dispatch(pauseGame());\n    }\n  };\n};\n\nexport const toggleTheme = themeToSet => {\n  return async dispatch => {\n    dispatch(setTheme(themeToSet));\n  };\n};\n\nexport const stepForwardFrame = () => {\n  return async (dispatch, getState) => {\n    const { currentFrame, frames } = getState().game;\n    const nextFrame = currentFrame.turn + 1;\n    const stepToFrame = getFrameByTurn(frames, nextFrame);\n    if (stepToFrame) {\n      dispatch(setCurrentFrame(stepToFrame));\n    }\n  };\n};\n\nexport const stepBackwardFrame = () => {\n  return async (dispatch, getState) => {\n    const { currentFrame, frames } = getState().game;\n    const prevFrame = currentFrame.turn - 1;\n    const stepToFrame = getFrameByTurn(frames, prevFrame);\n    if (stepToFrame) {\n      dispatch(setCurrentFrame(stepToFrame));\n    }\n  };\n};\n\nexport const stepToTurn = turn => {\n  return async (dispatch, getState) => {\n    const { frames } = getState().game;\n\n    const stepToFrame = getFrameByTurn(frames, turn);\n    if (stepToFrame) {\n      dispatch(setCurrentFrame(stepToFrame));\n    }\n  };\n};\n\nexport const togglePlayButtons = showHide => ({\n  type: types.TOGGLE_SETTINGS_VIEW,\n  showHide\n});\n\nexport const themeChanged = theme => ({\n  type: types.THEME_CHANGED,\n  theme\n});\n"]},"metadata":{},"sourceType":"module"}